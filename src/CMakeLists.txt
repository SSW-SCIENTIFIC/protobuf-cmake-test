find_package(Protobuf REQUIRED)

set(Protobuf_IMPORT_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/proto)

# # CASE 1: NG
# add_library(protobuf_autogenerated STATIC)
#
# set(Protobuf_IMPORT_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/proto)
# protobuf_generate_cpp(
#     GENERATED_SRCS
#     GENERATED_HDRS
#     ./proto/Message.proto
# )
# target_sources(protobuf_autogenerated
# PRIVATE
#     ${GENERATED_SRCS}
#     ${GENERATED_HDRS}
# )
# target_include_directories(protobuf_autogenerated
# PRIVATE
#     ${CMAKE_CURRENT_BINARY_DIR}
# INTERFACE
#     $<BUILD_INTERFACE:${CMAKE_CURRENT_BINARY_DIR}>
# )

# CASE 2: OK
add_subdirectory(proto)

add_executable(${CMAKE_PROJECT_NAME})
target_sources(${CMAKE_PROJECT_NAME}
PRIVATE
    main.cpp
)

target_include_directories(${CMAKE_PROJECT_NAME}
PRIVATE
    ${Protobuf_INCLUDE_DIRECTORY}
)

target_link_libraries(${CMAKE_PROJECT_NAME}
PRIVATE
    ${Protobuf_LIBRARIES}
    protobuf_autogenerated
)
